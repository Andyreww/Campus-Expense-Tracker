<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="logo.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nooksii - Your Ticket!</title>
    <link rel="stylesheet" href="gate.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Nunito:wght@700;900&family=Patrick+Hand&family=Special+Elite&display=swap" rel="stylesheet">
</head>
<body>
    <div class="orb"></div>
    <div class="orb"></div>
    <div class="orb"></div>

    <div class="stars">
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
    </div>

    <div class="ticket-container">
        <div class="ticket">
            <div class="ticket-stub">
                <div class="logo">ü¶â</div>
                <div class="stub-text">
                    <span>Admit One</span>
                    <strong>Nooksii Launch</strong>
                </div>
            </div>
            <div class="ticket-main">
                <div class="main-header">
                    <h1 class="gate-title">You're on the list.</h1>
                    <p class="gate-subtitle">Your access to Nooksii begins on move-in day.</p>
                </div>
                
                <div class="countdown" id="countdown">
                    <!-- Countdown will be generated by JS -->
                </div>
                
                <div class="ticket-footer">
                    <div class="footer-item">
                        <span>Date</span>
                        <strong>AUG 20, 2025</strong>
                    </div>
                    <div class="footer-item">
                        <span>Gate</span>
                        <strong>V1.0</strong>
                    </div>
                    <button id="logout-button" class="logout-button">Log Out</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Back to main site link -->
    <div style="position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 10;">
        <a href="index.html" style="color: rgba(255, 255, 255, 0.7); text-decoration: none; font-family: 'Lato', sans-serif; font-size: 0.9rem; transition: color 0.3s;">
            ‚Üê Back to Main Site
        </a>
    </div>

    <script type="module">
        import { logout } from './auth.js';
        
        // Set the date we're counting down to
        const launchDate = new Date("Aug 20, 2025 00:00:00").getTime();
        const countdownElement = document.getElementById("countdown");

        const x = setInterval(function() {
            const now = new Date().getTime();
            const distance = launchDate - now;

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            countdownElement.innerHTML = `
                <div><span>${days}</span>Days</div>
                <div><span>${hours}</span>Hours</div>
                <div><span>${minutes}</span>Mins</div>
                <div><span>${seconds}</span>Secs</div>
            `;

            if (distance < 0) {
                clearInterval(x);
                countdownElement.innerHTML = "<div class='go-time'>It's Go Time!</div>";
                
                // Auto-redirect to dashboard after launch
                setTimeout(() => {
                    window.location.replace('/dashboard.html');
                }, 1500);
                
                // Send launch email to user
                sendLaunchEmailToUser();
            }
        }, 1000);
        
        // Logout button functionality
        document.getElementById('logout-button').addEventListener('click', async () => {
            await logout();
            // The auth state listener in auth.js will handle the redirect
        });
        
        // Function to trigger launch email when countdown ends
        async function sendLaunchEmailToUser() {
            try {
                // Get current user email from auth
                const { auth } = await import('./auth.js').then(module => module.firebaseReady);
                if (auth && auth.currentUser) {
                    const response = await fetch('/.netlify/functions/send-launch-email', {
                        method: 'POST',
                        body: JSON.stringify({ email: auth.currentUser.email }),
                    });
                    
                    if (response.ok) {
                        console.log('Launch email sent successfully!');
                    }
                }
            } catch (error) {
                console.error('Failed to send launch email:', error);
            }
        }
    </script>
</body>
</html>